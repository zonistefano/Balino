{% extends "_layout.html" %}
{% block title %}Detect Circles{% endblock %}
{% block input %}active{% endblock %}
{% block circles %}active{% endblock %}

{% block content %}
<!-- Content -->
<div class="container">
    <h1>Circle Detector</h1>
    <div class="row py-2">
        <div class="col">
            <label for="videoSelect" class="form-label">Select camera</label>
            <select class="form-select" id="videoSelect">
            </select>
        </div>
        <div class="col-auto align-self-end">
            <button type="button" class="btn btn-success" id="btnStart">Start</button>
            <button type="button" class="btn btn-danger" hidden="hidden" id="btnStop">Stop</button>
        </div>
    </div>
    <div class="row py-2 g-2">
        <div class="col d-flex justify-content-center position-relative" id="in">
            <video autoplay playsinline id="videoIn"
                style="border-left-width: 0px !important; border-right-width: 0px !important;"></video>
            <canvas id="canvas_in" style="position: absolute;"></canvas>
            <canvas id="canvas" style="position: absolute;"></canvas>
        </div>
    </div>
    <!-- Settings Start -->
    <div class="row py-2 g-2 justify-content-around">
        <div class="col-5">
            <label for="param1" class="form-label" id="param1_">Param1: 50</label>
            <input type="range" class="form-range" min="1" max="100" step="1" value="50" id="param1">
        </div>
        <div class="col-5">
            <label for="param2" class="form-label" id="param2_">Param2: 50</label>
            <input type="range" class="form-range" min="1" max="100" step="1" value="50" id="param2">
        </div>
        <div class="col-5">
            <label for="minDist" class="form-label" id="minDist_">minDist: 20</label>
            <input type="range" class="form-range" min="5" max="300" step="5" value="20" id="minDist">
        </div>
        <div class="col-5">
            <label for="minR" class="form-label" id="minR_">minR: 10</label>
            <input type="range" class="form-range" min="0" max="99" step="1" value="10" id="minR">
        </div>
        <div class="col-5">
            <label for="maxR" class="form-label" id="maxR_">maxR: 50</label>
            <input type="range" class="form-range" min="0" max="100" step="1" value="50" id="maxR">
        </div>
    </div>
    <!-- Settings End -->

    <!-- Settings Explanation Start -->
    <div class="row py-2">
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        Parameter 1
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        Set the sensitivity; how strong the edges of the circles need to be. Too high and it won't
                        detect anything, too low and it will find too much clutter.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Parameter 2
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        Set how many edge points it needs to find to declare that it's found a circle
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        minDist
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        This parameter is the minimum distance between the centers
                        of the detected circles. If two circles are closer than this distance, only the stronger
                        one will be detected. This parameter helps to eliminate false positives.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        minR
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        This parameter is the minimum radius of the detected
                        circles. Circles with a smaller radius than this value will not be detected.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                        maxR
                    </button>
                </h2>
                <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        This parameter is the maximum radius of the
                        detected circles. Circles with a larger radius than this value will not be detected.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Settings Explanation End -->

</div>
<!-- Content End -->


<!-- JS Elements Start -->
<script>
    const videoIn = document.getElementById('videoIn');
    const canvas = document.getElementById('canvas');
    const btnStart = document.getElementById("btnStart");
    const btnStop = document.getElementById("btnStop");
    const videoSelect = document.getElementById('videoSelect');
    const contIn = document.getElementById('in');
    const context = canvas.getContext('2d');
    const canvas_in = document.getElementById('canvas_in');
    const ctx_ci = canvas_in.getContext('2d');
    const param1 = document.getElementById("param1");
    const param2 = document.getElementById('param2');
    const minDist = document.getElementById('minDist')
    const minR = document.getElementById("minR");
    const maxR = document.getElementById('maxR');
    const param1_ = document.getElementById("param1_");
    const param2_ = document.getElementById('param2_');
    const minDist_ = document.getElementById('minDist_')
    const minR_ = document.getElementById("minR_");
    const maxR_ = document.getElementById('maxR_');
</script>
<!-- JS Elements End -->

<!-- JS UI Start -->
<script>
    param1.oninput = function () {
        param1_.textContent = 'Param1: ' + param1.value
    }
    param2.oninput = function () {
        param2_.textContent = 'Param2: ' + param2.value
    }
    minDist.oninput = function () {
        minDist_.textContent = 'minDist: ' + minDist.value
    }
    minR.oninput = function () {
        minR_.textContent = 'minR: ' + minR.value
    }
    maxR.oninput = function () {
        maxR_.textContent = 'maxR: ' + maxR.value
    }
</script>
<!-- JS UI End -->

<!-- JS Import Start -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
<script src="/static/js/raphael.min.js"></script>
<script async src="/static/js/opencv.js" type="text/javascript"></script>
<script src="/static/js/video.js"></script>
<script src="/static/js/drawing.js"></script>
<script src="/static/js/circles.js"></script>
<!-- JS Import End -->
{% endblock %}