{% extends "_layout.html" %}
{% block title %}Manual Input{% endblock %}
{% block input %}active{% endblock %}
{% block manual %}active{% endblock %}

{% block content %}
<!-- Content -->
<div class="container">
    <!-- Settings Start -->
    <div class="row py-2">
        <div class="col">
            <label for="ball_n" class="form-label">Select Number of balls:</label>
            <select class="form-select" id="ball_n">
                <option selected>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
            </select>
        </div>
        <div class="col-auto align-self-end">
            <button type="button" class="btn btn-primary" id="confirm">Confirm</button>
        </div>
    </div>
    <div class="row py-2 g-2 justify-content-around" id="positions">
    </div>
    <!-- Settings End -->
</div>
<!-- Content End -->


<!-- JS Elements Start -->
<script>
    const confirm = document.getElementById("confirm");
    const positions = document.getElementById("positions");
    const ball_n = document.getElementById('ball_n');
</script>
<!-- JS Elements End -->

<!-- JS UI Start -->
<script>
    const socket = io();

    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }

    confirm.onclick = function () {
        let width = document.body.scrollWidth;
        let height = document.body.scrollHeight;

        let circlesJSON = { circles: [], height: height, width: width }; // create an empty JSON object

        positions.innerHTML = '';
        for (let i = 0; i < ball_n.value; ++i) {
            let x = getRandomInt(width);
            let y = getRandomInt(height);
            let r = getRandomInt(height / 8);

            positions.innerHTML +=
                `<div class="col-4">
            <label for="ballx${i}" class="form-label" id="ballx${i}_">Ball ${i} X: ${x}</label>
            <input type="range" class="form-range" min="0" max="${width}" step="1" value="${x}" id="ballx${i}">
            </div>
            <div class="col-4">
            <label for="bally${i}" class="form-label" id="bally${i}_">Ball ${i} Y: ${y}</label>
            <input type="range" class="form-range" min="0" max="${height}" step="1" value="${y}" id="bally${i}">
            </div>
            <div class="col-4">
            <label for="ballr${i}" class="form-label" id="ballr${i}_">Ball ${i} R: ${r}</label>
            <input type="range" class="form-range" min="1" max="${height / 3}" step="1" value="${r}" id="ballr${i}">
            </div>`;

            // create a new circle object with x, y, and radius properties
            let circle = { id: i, x: x, y: y, r: r };
            // add the circle object to the JSON array
            circlesJSON.circles.push(circle);
        }
        socket.emit('circles', circlesJSON)
        for (let i = 0; i < ball_n.value; ++i) {
            let ballx = document.getElementById(`ballx${i}`);
            let ballxLabel = document.getElementById(`ballx${i}_`);
            ballx.addEventListener('input', function () {
                ballxLabel.innerHTML = `Ball ${i} X: ${ballx.value}`;
                circlesJSON.circles[i].x = ballx.value;
                socket.emit('circles', circlesJSON)
            });

            let bally = document.getElementById(`bally${i}`);
            let ballyLabel = document.getElementById(`bally${i}_`);
            bally.addEventListener('input', function () {
                ballyLabel.innerHTML = `Ball ${i} Y: ${bally.value}`;
                circlesJSON.circles[i].y = bally.value;
                socket.emit('circles', circlesJSON)
            });

            let ballr = document.getElementById(`ballr${i}`);
            let ballrLabel = document.getElementById(`ballr${i}_`);
            ballr.addEventListener('input', function () {
                ballrLabel.innerHTML = `Ball ${i} R: ${ballr.value}`;
                circlesJSON.circles[i].r = ballr.value;
                socket.emit('circles', circlesJSON)
            });
        }
    };
</script>
<!-- JS UI End -->

<!-- JS Import Start -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
<!-- JS Import End -->
{% endblock %}